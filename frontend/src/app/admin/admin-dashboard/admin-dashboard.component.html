<div class="dashboard-wrapper">
  <!-- Header Section -->
  <header class="dashboard-header">
    <div class="header-content">
      <div class="header-title">
        <span class="header-icon">âš™ï¸</span>
        <div>
          <h1>Admin Dashboard</h1>
          <p class="header-subtitle">Manage users and monitor MMSE test results</p>
        </div>
      </div>
      <div class="header-date">
        <span class="date-icon">ğŸ“…</span>
        <span>{{ today | date:'fullDate' }}</span>
      </div>
    </div>
  </header>

  <!-- Stats Cards -->
  <section class="stats-grid">
    <div class="stat-card users-card">
      <div class="stat-icon">ğŸ‘¥</div>
      <div class="stat-content">
        <span class="stat-label">Total Users</span>
        <span class="stat-value">{{ stats.usersCount }}</span>
      </div>
      <div class="stat-trend trend-up">
        <span>â†—</span>
      </div>
    </div>
    
    <div class="stat-card active-card">
      <div class="stat-icon">âœ…</div>
      <div class="stat-content">
        <span class="stat-label">Active Users</span>
        <span class="stat-value">{{ stats.activeUsersCount }}</span>
      </div>
      <div class="stat-trend trend-up">
        <span>â†—</span>
      </div>
    </div>
    
    <div class="stat-card tests-card">
      <div class="stat-icon">ğŸ“‹</div>
      <div class="stat-content">
        <span class="stat-label">MMSE Tests</span>
        <span class="stat-value">{{ stats.mmseTestsCount }}</span>
      </div>
      <div class="stat-trend trend-neutral">
        <span>â†’</span>
      </div>
    </div>
    
    <div class="stat-card rate-card">
      <div class="stat-icon">ğŸ“Š</div>
      <div class="stat-content">
        <span class="stat-label">Completion Rate</span>
        <span class="stat-value">{{ stats.usersCount > 0 ? ((stats.mmseTestsCount / stats.usersCount) * 100).toFixed(0) : 0 }}%</span>
      </div>
      <div class="stat-trend trend-up">
        <span>â†—</span>
      </div>
    </div>
  </section>

  <!-- Users Table Section -->
  <section class="table-section">
    <div class="section-header">
      <h2>
        <span class="section-icon">ğŸ‘¤</span>
        Users & MMSE Test Results
      </h2>
      <div class="section-actions">
        <button class="btn-refresh" (click)="loadDashboard()">
          <span>ğŸ”„</span> Refresh
        </button>
      </div>
    </div>

    <!-- Loading State -->
    <div *ngIf="loading" class="loading-state">
      <div class="spinner"></div>
      <p>Loading dashboard data...</p>
    </div>

    <!-- Error State -->
    <div *ngIf="error" class="error-state">
      <span class="error-icon">âš ï¸</span>
      <p>{{ error }}</p>
      <button class="btn-retry" (click)="loadDashboard()">Try Again</button>
    </div>

    <!-- Data Table -->
    <div *ngIf="!loading && users.length > 0" class="table-container">
      <table class="data-table">
        <thead>
          <tr>
            <th>ID</th>
            <th>User</th>
            <th>Email</th>
            <th>Role</th>
            <th>Status</th>
            <th>MMSE Results</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let user of users; let i = index" [class.alternate]="i % 2 === 1">
            <td class="cell-id">
              <span class="id-badge">#{{ user.userId }}</span>
            </td>
            <td class="cell-user">
              <div class="user-info">
                <div class="user-avatar">{{ user.firstName?.charAt(0) }}{{ user.lastName?.charAt(0) }}</div>
                <span class="user-name">{{ user.firstName }} {{ user.lastName }}</span>
              </div>
            </td>
            <td class="cell-email">
              <a href="mailto:{{ user.email }}">{{ user.email }}</a>
            </td>
            <td class="cell-role">
              <span class="role-badge" [ngClass]="user.role?.toLowerCase()">
                {{ user.role }}
              </span>
            </td>
            <td class="cell-status">
              <span class="status-badge" [ngClass]="{'status-active': user.active, 'status-inactive': !user.active}">
                <span class="status-dot"></span>
                {{ user.active ? 'Active' : 'Inactive' }}
              </span>
            </td>
            <td class="cell-mmse">
              <div *ngIf="user.mmseTests && user.mmseTests.length > 0" class="mmse-container">
                <div *ngFor="let test of user.mmseTests" class="mmse-card">
                  <div class="mmse-score">
                    <span class="score-value">{{ test.totalScore }}</span>
                    <span class="score-total">/30</span>
                  </div>
                  <div class="mmse-details">
                    <span class="mmse-interpretation" [ngClass]="getInterpretationClass(test.totalScore)">
                      {{ getMMSEInterpretation(test.totalScore) }}
                    </span>
                    <span class="mmse-date">{{ test.testDate | date:'MMM d, yyyy' }}</span>
                  </div>
                </div>
              </div>
              <div *ngIf="!user.mmseTests || user.mmseTests.length === 0" class="no-tests-badge">
                <span>â€”</span> No tests
              </div>
            </td>
            <td class="cell-actions">
              <div class="action-buttons">
                <button class="btn-action btn-view" title="View Details">ğŸ‘ï¸</button>
                <button class="btn-action btn-edit" title="Edit User">âœï¸</button>
                <button class="btn-action btn-delete" (click)="deleteUser(user.userId)" title="Delete User">ğŸ—‘ï¸</button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Empty State -->
    <div *ngIf="!loading && users.length === 0" class="empty-state">
      <span class="empty-icon">ğŸ“­</span>
      <h3>No Users Found</h3>
      <p>There are no users in the system yet.</p>
    </div>
  </section>
</div>
