<div class="mmse-container">
  <!-- Header -->
  <div class="header">
    <h1>ğŸ§  MMSE Test - Mini-Mental State Examination</h1>
    <p class="subtitle">Cognitive Assessment for Alzheimer Detection</p>
  </div>

  <!-- Error Alert -->
  <div *ngIf="error" class="alert alert-error">
    <strong>Error:</strong> {{ error }}
  </div>

  <!-- Success Alert -->
  <div *ngIf="success" class="alert alert-success">
    <strong>Success!</strong> {{ success }}
  </div>

  <!-- Intro Section -->
  <div *ngIf="currentSection === 'intro'" class="section">
    <div class="intro-card">
      <h2>Welcome to MMSE Test</h2>
      <p>This is a 30-point questionnaire to assess cognitive impairment in 11 categories:</p>
      <ul class="test-categories">
        <li><strong>Orientation to Time:</strong> 5 points</li>
        <li><strong>Orientation to Place:</strong> 5 points</li>
        <li><strong>Registration:</strong> 3 points</li>
        <li><strong>Attention & Calculation:</strong> 5 points</li>
        <li><strong>Recall:</strong> 3 points</li>
        <li><strong>Language:</strong> 8 points</li>
        <li><strong>Visual-Spatial:</strong> 1 point</li>
      </ul>

      <div class="patient-info">
        <label>Patient Name:</label>
        <input type="text" v-model="patientName" [(ngModel)]="patientName" placeholder="Enter patient full name" class="input-field">

        <label>Test Date:</label>
        <input type="date" [(ngModel)]="testDate" class="input-field">

        <label>Notes (Optional):</label>
        <textarea [(ngModel)]="notes" placeholder="Additional notes about the patient..." class="input-field"></textarea>
      </div>

      <button (click)="startTest()" class="btn btn-primary btn-large">
        Start Test
      </button>

      <div class="instructions">
        <p>ğŸ“‹ <strong>Instructions:</strong></p>
        <p>Answer all questions carefully. Each correct answer is marked. Your total score out of 30 determines the cognitive status.</p>
      </div>
    </div>
  </div>

  <!-- Orientation to Time Section -->
  <div *ngIf="currentSection === 'orientation-time'" class="section">
    <div class="progress-bar">
      <div class="progress" style="width: 15%"></div>
    </div>

    <div class="test-card">
      <h2>ğŸ• Orientation to Time (5 points)</h2>
      <p class="section-desc">Ask the patient to state the date and day of the week.</p>

      <div class="question-group">
        <label class="checkbox-label">
          <input type="checkbox" [(ngModel)]="orientationTime.year"> What is the year?
        </label>
        <label class="checkbox-label">
          <input type="checkbox" [(ngModel)]="orientationTime.season"> What is the season?
        </label>
        <label class="checkbox-label">
          <input type="checkbox" [(ngModel)]="orientationTime.month"> What is the month?
        </label>
        <label class="checkbox-label">
          <input type="checkbox" [(ngModel)]="orientationTime.date"> What is the date?
        </label>
        <label class="checkbox-label">
          <input type="checkbox" [(ngModel)]="orientationTime.day"> What is the day of the week?
        </label>
      </div>

      <div class="button-group">
        <button (click)="nextSection('orientation-place')" class="btn btn-primary">
          Next Section â†’
        </button>
      </div>
    </div>
  </div>

  <!-- Orientation to Place Section -->
  <div *ngIf="currentSection === 'orientation-place'" class="section">
    <div class="progress-bar">
      <div class="progress" style="width: 30%"></div>
    </div>

    <div class="test-card">
      <h2>ğŸ“ Orientation to Place (5 points)</h2>
      <p class="section-desc">Ask the patient to identify the location details.</p>

      <div class="question-group">
        <label class="checkbox-label">
          <input type="checkbox" [(ngModel)]="orientationPlace.state"> What state are we in?
        </label>
        <label class="checkbox-label">
          <input type="checkbox" [(ngModel)]="orientationPlace.county"> What county are we in?
        </label>
        <label class="checkbox-label">
          <input type="checkbox" [(ngModel)]="orientationPlace.city"> What city are we in?
        </label>
        <label class="checkbox-label">
          <input type="checkbox" [(ngModel)]="orientationPlace.hospital"> What building are we in?
        </label>
        <label class="checkbox-label">
          <input type="checkbox" [(ngModel)]="orientationPlace.floor"> What floor are we on?
        </label>
      </div>

      <div class="button-group">
        <button (click)="nextSection('orientation-time')" class="btn btn-secondary">
          â† Previous
        </button>
        <button (click)="nextSection('registration')" class="btn btn-primary">
          Next Section â†’
        </button>
      </div>
    </div>
  </div>

  <!-- Registration Section -->
  <div *ngIf="currentSection === 'registration'" class="section">
    <div class="progress-bar">
      <div class="progress" style="width: 45%"></div>
    </div>

    <div class="test-card">
      <h2>ğŸ“ Registration (3 points)</h2>
      <p class="section-desc">Tell the patient you will say three words and ask him/her to repeat them at the end: Apple, Penny, Table. Say them clearly and at about one-second intervals.</p>

      <div class="question-group">
        <label class="checkbox-label">
          <input type="checkbox" [(ngModel)]="registration.apple"> Patient repeated: Apple
        </label>
        <label class="checkbox-label">
          <input type="checkbox" [(ngModel)]="registration.penny"> Patient repeated: Penny
        </label>
        <label class="checkbox-label">
          <input type="checkbox" [(ngModel)]="registration.table"> Patient repeated: Table
        </label>
      </div>

      <div class="button-group">
        <button (click)="nextSection('orientation-place')" class="btn btn-secondary">
          â† Previous
        </button>
        <button (click)="nextSection('attention-calculation')" class="btn btn-primary">
          Next Section â†’
        </button>
      </div>
    </div>
  </div>

  <!-- Attention and Calculation Section -->
  <div *ngIf="currentSection === 'attention-calculation'" class="section">
    <div class="progress-bar">
      <div class="progress" style="width: 60%"></div>
    </div>

    <div class="test-card">
      <h2>ğŸ§® Attention and Calculation (5 points)</h2>
      <p class="section-desc">Ask the patient to count backward from 100 by sevens. Stop after five answers (93, 86, 79, 72, 65).</p>

      <div class="question-group">
        <label class="checkbox-label">
          <input type="checkbox" [(ngModel)]="attentionCalculation.serial7_1"> 100 - 7 = 93 âœ“
        </label>
        <label class="checkbox-label">
          <input type="checkbox" [(ngModel)]="attentionCalculation.serial7_2"> 93 - 7 = 86 âœ“
        </label>
        <label class="checkbox-label">
          <input type="checkbox" [(ngModel)]="attentionCalculation.serial7_3"> 86 - 7 = 79 âœ“
        </label>
        <label class="checkbox-label">
          <input type="checkbox" [(ngModel)]="attentionCalculation.serial7_4"> 79 - 7 = 72 âœ“
        </label>
        <label class="checkbox-label">
          <input type="checkbox" [(ngModel)]="attentionCalculation.serial7_5"> 72 - 7 = 65 âœ“
        </label>
      </div>

      <div class="button-group">
        <button (click)="nextSection('registration')" class="btn btn-secondary">
          â† Previous
        </button>
        <button (click)="nextSection('recall')" class="btn btn-primary">
          Next Section â†’
        </button>
      </div>
    </div>
  </div>

  <!-- Recall Section -->
  <div *ngIf="currentSection === 'recall'" class="section">
    <div class="progress-bar">
      <div class="progress" style="width: 75%"></div>
    </div>

    <div class="test-card">
      <h2>ğŸ§  Recall (3 points)</h2>
      <p class="section-desc">Ask the patient to recall the three words you mentioned earlier (Apple, Penny, Table).</p>

      <div class="question-group">
        <label class="checkbox-label">
          <input type="checkbox" [(ngModel)]="recall.apple"> Patient recalls: Apple
        </label>
        <label class="checkbox-label">
          <input type="checkbox" [(ngModel)]="recall.penny"> Patient recalls: Penny
        </label>
        <label class="checkbox-label">
          <input type="checkbox" [(ngModel)]="recall.table"> Patient recalls: Table
        </label>
      </div>

      <div class="button-group">
        <button (click)="nextSection('attention-calculation')" class="btn btn-secondary">
          â† Previous
        </button>
        <button (click)="nextSection('language')" class="btn btn-primary">
          Next Section â†’
        </button>
      </div>
    </div>
  </div>

  <!-- Language Section -->
  <div *ngIf="currentSection === 'language'" class="section">
    <div class="progress-bar">
      <div class="progress" style="width: 90%"></div>
    </div>

    <div class="test-card">
      <h2>ğŸ—£ï¸ Language (8 points)</h2>
      <p class="section-desc">Test the patient's language abilities through naming, repetition, and comprehension.</p>

      <div class="question-group">
        <h4>Naming (2 points):</h4>
        <label class="checkbox-label">
          <input type="checkbox" [(ngModel)]="language.naming_watch"> Patient names: Watch
        </label>
        <label class="checkbox-label">
          <input type="checkbox" [(ngModel)]="language.naming_pencil"> Patient names: Pencil
        </label>

        <h4 style="margin-top: 15px;">Repetition (1 point):</h4>
        <label class="checkbox-label">
          <input type="checkbox" [(ngModel)]="language.repetition"> Patient repeats: "No ifs, ands, or buts"
        </label>

        <h4 style="margin-top: 15px;">3-Stage Command (3 points):</h4>
        <p class="command-text">"Take a piece of paper in your right hand, fold it in half, and put it on the floor"</p>
        <label class="checkbox-label">
          <input type="checkbox" [(ngModel)]="language.command_1"> Take paper in right hand âœ“
        </label>
        <label class="checkbox-label">
          <input type="checkbox" [(ngModel)]="language.command_2"> Fold it in half âœ“
        </label>
        <label class="checkbox-label">
          <input type="checkbox" [(ngModel)]="language.command_3"> Put it on the floor âœ“
        </label>

        <h4 style="margin-top: 15px;">Reading & Writing (2 points):</h4>
        <label class="checkbox-label">
          <input type="checkbox" [(ngModel)]="language.reading"> Patient reads and obeys: "CLOSE YOUR EYES"
        </label>
        <label class="checkbox-label">
          <input type="checkbox" [(ngModel)]="language.writing"> Patient writes a sentence spontaneously
        </label>
      </div>

      <div class="button-group">
        <button (click)="nextSection('recall')" class="btn btn-secondary">
          â† Previous
        </button>
        <button (click)="nextSection('visual-spatial')" class="btn btn-primary">
          Next Section â†’
        </button>
      </div>
    </div>
  </div>

  <!-- Visual-Spatial Section -->
  <div *ngIf="currentSection === 'visual-spatial'" class="section">
    <div class="progress-bar">
      <div class="progress" style="width: 100%"></div>
    </div>

    <div class="test-card">
      <h2>âœï¸ Visual-Spatial (1 point)</h2>
      <p class="section-desc">Ask the patient to copy the design shown. Award 1 point for correctly intersecting pentagons.</p>

      <div class="visual-section">
        <div class="pentagon-demo">
          <p>Reference Design (Two Intersecting Pentagons):</p>
          <svg viewBox="0 0 200 150" class="pentagon-svg">
            <!-- Pentagon 1 -->
            <polygon points="100,20 130,60 115,110 85,110 70,60" fill="none" stroke="#667eea" stroke-width="2"/>
            <!-- Pentagon 2 -->
            <polygon points="120,40 150,80 135,130 105,130 90,80" fill="none" stroke="#764ba2" stroke-width="2"/>
          </svg>
        </div>

        <label class="checkbox-label">
          <input type="checkbox" [(ngModel)]="visualSpatial.copy"> Pentagons intersect correctly
        </label>
      </div>

      <div class="button-group">
        <button (click)="nextSection('language')" class="btn btn-secondary">
          â† Previous
        </button>
        <button (click)="submitTest()" [disabled]="loading" class="btn btn-success btn-large">
          <span *ngIf="!loading">ğŸ“Š Submit Test</span>
          <span *ngIf="loading">Submitting...</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Result Section -->
  <div *ngIf="currentSection === 'result'" class="section">
    <div class="result-card" [ngClass]="getInterpretation(totalScore).toLowerCase().replace(/\s+/g, '-')">
      <h2>ğŸ“‹ Test Complete</h2>
      
      <div class="score-display">
        <div class="score-circle">
          <span class="score-number">{{ totalScore }}</span>
          <span class="score-total">/30</span>
        </div>
      </div>

      <div class="result-interpretation" [ngClass]="'result-' + (totalScore >= 24 ? 'normal' : totalScore >= 18 ? 'mild' : totalScore >= 12 ? 'moderate' : 'severe')">
        <h3>{{ getInterpretation(totalScore) }}</h3>
        <p *ngIf="totalScore >= 24">âœ… Normal cognitive function. No significant impairment detected.</p>
        <p *ngIf="totalScore >= 18 && totalScore < 24">âš ï¸ Mild cognitive impairment. May benefit from further evaluation.</p>
        <p *ngIf="totalScore >= 12 && totalScore < 18">âš ï¸ Moderate cognitive impairment. Professional evaluation recommended.</p>
        <p *ngIf="totalScore < 12">ğŸš¨ Severe cognitive impairment. Immediate professional intervention recommended.</p>
      </div>

      <div class="score-breakdown">
        <h4>Score Breakdown:</h4>
        <div class="breakdown-grid">
          <div class="breakdown-item">
            <span>Orientation (Time & Place):</span>
            <strong>{{ getOrientationScore() }}/10</strong>
          </div>
          <div class="breakdown-item">
            <span>Registration:</span>
            <strong>{{ getRegistrationScore() }}/3</strong>
          </div>
          <div class="breakdown-item">
            <span>Attention & Calculation:</span>
            <strong>{{ getAttentionScore() }}/5</strong>
          </div>
          <div class="breakdown-item">
            <span>Recall:</span>
            <strong>{{ getRecallScore() }}/3</strong>
          </div>
          <div class="breakdown-item">
            <span>Language:</span>
            <strong>{{ getLanguageScore() }}/8</strong>
          </div>
          <div class="breakdown-item">
            <span>Visual-Spatial:</span>
            <strong>{{ getVisualScore() }}/1</strong>
          </div>
        </div>
      </div>

      <div class="result-patient-info">
        <p><strong>Patient:</strong> {{ patientName }}</p>
        <p><strong>Test Date:</strong> {{ testDate }}</p>
        <p *ngIf="notes"><strong>Notes:</strong> {{ notes }}</p>
      </div>

      <div class="button-group">
        <button (click)="resetTest()" class="btn btn-primary btn-large">
          Take Another Test
        </button>
        <button (click)="goHome()" class="btn btn-secondary btn-large">
          Back to Home
        </button>
      </div>
    </div>
  </div>
</div>
